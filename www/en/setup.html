<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- don't edit start -->
<head><title>Seasar - DI Container with AOP - </title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<link href="seasar_b.css" type="text/css" rel="stylesheet" media="screen"><script src="seasar_b.js" type="text/JavaScript" language="JavaScript"></script>
</head><body onload="preload('en')">
<table width="100%" border="0" cellspacing="0" cellpadding="0" align="left"><tr>
<td align="left" valign="top" width="780"><table width="780" border="0" cellspacing="0" cellpadding="0" class="white">
<tr><td colspan="7"><img height="5" width="780" src="images/top01_b.gif" alt=""></td></tr>
<tr><td><img height="117" width="235" src="images/top02_b.gif" alt="Seasar"></td>
<td colspan="3"><img height="117" width="289" src="images/top03.gif" alt="DI Container with AOP"></td>
<td colspan="3"><img height="117" width="256" src="images/spacer.gif" alt=""></td>
</tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235"></td>
<td><a href="http://www.seasar.org/en/index.html"><img src="images/menu01_b_en.gif" height="30" width="78" border="0" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)"></a></td>
<td><a href="http://www.seasar.org/en/projects.html"><img src="images/menu02_b_en.gif" height="30" width="101" border="0" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)"></a></td>
<td><a href="http://www.seasar.org/en/products.html"><img src="images/menu06_b_en.gif" height="30" width="110" border="0" alt="" id="menu06" onmouseover="swap(6)" onmouseout="restore(6)"></a></td>
<td><a href="http://www.seasar.org/en/documents.html"><img src="images/menu04_b_en.gif" height="30" width="109" border="0" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)"></a></td>
<td><a href="http://www.seasar.org/en/resources.html"><img src="images/menu05_b_en.gif" height="30" width="113" border="0" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)"></a></td>
<!--
<td><img src="images/menu07_b_en.gif" height="30" width="109" border="0" alt=""  id="menu07" onmouseover="swap(7)" onmouseout="restore(7)"></td>
//-->
<td><img height="30" width="34" src="images/menu06.gif" alt=""></td></tr><tr>

<td colspan="6"><img height="19" width="545" src="images/spacer.gif" alt=""></td></tr></table>
<table  width="780" border="0" cellspacing="0" cellpadding="0" class="menu">
<tr align="left" valign="top"><td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td><td width="740" class="main">
<!-- don't edit end --><!-- document start -->

<a href="index.html">S2Container.NET TOP page</a>
<h2>S2Container Setup</h2>

<ul>
	<li><a href="#requirements">Requirements</a></li>
	<li><a href="#DownloadFile">Distribution Files</a></li>
	<li><a href="#S2Container">S2Container.NET Setup</a></li>
	<li><a href="#log4net">log4net Setup</a></li>
	<li><a href="#S2ADO">S2ADO Setup</a></li>
	<li><a href="#S2Unit">S2Unit.NET Setup</a></li>
	<li><a href="#Seasar.DynamicProxy">Seasar.DynamicProxy Setup</a></li>
	<li><a href="#Examples">Examples</a></li>
</ul>

<h2><a name="requirements">Requirements</a></h2>
<ul>
<li>Microsoft .NET Framework 1.1 or 2.0
<li><a href="http://sourceforge.net/projects/nunit">NUnit</a> (required only if modifying s2dotnet and to test the modified version)
</ul>

<h2><a name="DownloadFile">Distribution Files</a></h2>
Following files and folders are created with <p>s2container.net-<span style="font-style:italic;">version</span>.zip is extracted.
<table border="1">
	<tr bgcolor="#d1f3f4" align="center">
		<th>Folder</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>s2container.net/build</td>
		<td>S2Container.NET release build assembly</td>
	</tr>
	<tr>
		<td>s2container.net/data</td>
		<td>DDL necessary to run examples</td>
	</tr>
	<tr>
		<td>s2container.net/lib</td>
		<td>Assembly referenced by S2Container.NET</td>
	</tr>
	<tr>
		<td>s2container.net/source</td>
		<td>S2Container.NET source code</td>
	</tr>
	<tr>
		<td>www</td>
		<td>Document</td>
	</tr>
</table>

<h2><a name="S2Container">S2Container.NET Setup</a></h2>
<p>
  When using S2Container.NET, following files (assembly) must be added to referenced files. Furthermore, make Seasar.dll in build directory as ja-JP directory.
	<ul>
		<li>s2container.net/build/Seasar.dll</li>
		<li>s2container.net/lib/log4net.dll</li>
	</ul>
</p>
<p>
  Next, set configuration in application configuration file (app.config) if necessary. Refer to the following page to set this configuration file.
</p>
<p>
	<a href="dicontainer.html#AppConfig">S2Container.NET Reference - Application Configuration File</a>
</p>

<h2><a name="log4net">log4net Setup</a></h2>
<p>S2Container.NET uses <a href="http://logging.apache.org/log4net/">Apache Logging Services project log4net</a>. Thus, it is necessary to set log4net to log S2Container.NET.
Following is an example of log4net configuration.
</p>
<h3>Specifying log4net Configuration File</h3>
<p>
	Following attributes are specified in the AssemblyInfo.<br />
	This will set application configuration file (app.config) in log4net.
</p>

C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
[assembly: log4net.Config.XmlConfigurator(Watch=<span class="kwrd">true</span>)]</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
&lt;<span class="kwrd">Assembly</span>: log4net.Config.XmlConfigurator(Watch:=<span class="kwrd">True</span>)&gt;
</pre>

<h3>Add log4net configuration in application configuration file (app.config).</h3>
<p>
	Below is an example using TraceAdapter.
</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">configSections</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">section</span> <span class="attr">name</span><span class="kwrd">="log4net"</span> <span class="attr">type</span><span class="kwrd">="System.Configuration.IgnoreSectionHandler"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">section</span> <span class="attr">name</span><span class="kwrd">="seasar"</span> <span class="attr">type</span><span class="kwrd">="Seasar.Framework.Xml.S2SectionHandler, Seasar"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">configSections</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">log4net</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">appender</span> <span class="attr">name</span><span class="kwrd">="TraceAppender"</span> <span class="attr">type</span><span class="kwrd">="log4net.Appender.TraceAppender"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">layout</span> <span class="attr">type</span><span class="kwrd">="log4net.Layout.PatternLayout"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">conversionPattern</span> <span class="attr">value</span><span class="kwrd">="%-5p %d [%t] %m%n"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">layout</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">appender</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">root</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">level</span> <span class="attr">value</span><span class="kwrd">="DEBUG"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">appender-ref</span> <span class="attr">ref</span><span class="kwrd">="TraceAppender"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">root</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;/</span><span class="html">log4net</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">seasar</span><span class="kwrd">&gt;</span>
        <span class="rem">&lt;!-- omitted --&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">seasar</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span></pre>

<p>
That ends log4net setup.
</p>
<p>
When an application configuration file that is configured with log4net does not log using log4net, however, log will not be outputted. As an example, if Seasar assembly tries to log an output, log4net tries to find log4net configuration in a Seasar assembly and will not output a log.
</p>
<p>
To properly output a log, therefore, output a log from the application configured in log4net configuration, or add a step to read application configuration file when the program starts.
</p>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
System.IO.FileInfo info = <span class="kwrd">new</span> System.IO.FileInfo(
   log4net.Util.SystemInfo.AssemblyShortName(
   System.Reflection.Assembly.GetExecutingAssembly())
   + <span class="str">".exe.config"</span>); <span class="rem">// if an assembly is a dll, use ".dll.config"</span>

log4net.Config.XmlConfigurator.Configure(
   log4net.LogManager.GetRepository(), info);
</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Dim</span> info <span class="kwrd">As</span> <span class="kwrd">New</span> System.IO.FileInfo( _
   log4net.Util.SystemInfo.AssemblyShortName( _
   System.Reflection.<span class="kwrd">Assembly</span>.GetExecutingAssembly()) _
   + <span class="str">".exe.config"</span>) <span class="rem">' if an assembly is a dll, use ".dll.config"</span>

log4net.Config.XmlConfigurator.Configure( _
   log4net.LogManager.GetRepository(), info)
</pre>

<h2><a name="S2ADO">S2ADO Setup</a></h2>
<p>
  When using S2ADO, following files (assembly) must be added to referenced files.
	<ul>
		<li>s2container.net/lib/Nullables.dll</li>
	</ul>
</p>
<p>
  Next, set configuration in application configuration file (app.config) if necessary. Refer to the following page to set this configuration file.
</p>
<p>
	<a href="db.html#AppConfig">S2Container.NET Reference - Application Configuration File</a>
</p>

<h2><a name="S2Unit">S2Unit.NET Setup</a></h2>
<p>
	S2Unit.NET is a testing framework to make testing with S2Container easier.
</p>
<p>
Download and install <a href="http://www.mertner.com/confluence/display/MbUnit/Home" target="_blank">MbUnit 2.3.0</a> to use S2Unit.NET. <span style="color:red;font-weight:bold;">The current release of S2Unit.NET requires MbUnit version 2.3.0 - it does not run properly with any other version.</span>
</p>
<p>
Test class extends Seasar.Extension.Unit.S2TestCase.
S2TestCase class is included in Seasar.Unit.dll. Thus, a project with test codes should reference this Seasar.Unit.dll.
</p>
<p>Refer to <a href="s2unit.html">S2Unit.NET</a> for further information.</p>

<h2><a name="Seasar.DynamicProxy">Seasar.DynamicProxy Setup</a></h2>
<p>
	By default, S2AOP.NET implements System.Runtime.Remoting.Proxies.RealProxy, but it is possible to use <a href="http://www.castleproject.org/index.php/DynamicProxy">Castle.DynamicProxy</a>.
	Refer to the following document for further information on Seasar.DynamicProxy.
</p>
<p>
	<a href="aop.html#Seasar.DynamicProxy">AOP - Seasar.DynamicProxy</a>
</p>
<p>
	To use Seasar.DynamicProxy, add references to the following files:
	<ul>
		<li>s2container.net/build/Seasar.DynamicProxy.dll</li>
		<li>s2container.net/lib/Castle.DynamicProxy.dll<br />(It is not necessary to add reference to this dll, if Seasar.DynamicProxy.dll is placed in a folder that is visible from the project)
</li>
	</ul>
</p>
<p>
	Add [Seasar.DynamicProxy] assembly to application configuration file (App.config) as below:
</p>

<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">configSections</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">section</span> <span class="attr">name</span><span class="kwrd">="seasar"</span> <span class="attr">type</span><span class="kwrd">="Seasar.Framework.Xml.S2SectionHandler, Seasar"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">configSections</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">seasar</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">configPath</span><span class="kwrd">&gt;</span>App.dicon<span class="kwrd">&lt;/</span><span class="html">configPath</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">assemblys</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">assembly</span><span class="kwrd">&gt;</span>Seasar.DynamicProxy<span class="kwrd">&lt;/</span><span class="html">assembly</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">assemblys</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">seasar</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
</pre>

<p>
	Add Seasar.Framework.Aop.Impl.DynamicAopProxyAspectWeaver class to the dicon file as below.
	<span style="color:red;">Use caution on row placement so DynamicAopProxyAspectWeaver will be resolved before an aspect is applied to a component.
	</span>
</p>

<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Framework.Aop.Impl.DynamicAopProxyAspectWeaver"</span> <span class="kwrd">/&gt;</span>

    ...
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>
<p>
That ends Seasar.DynamicProxy setup.
</p>

<h2><a name="Examples">Examples</a></h2>
<p>
To run examples, open s2container.net/source/Seasar.sln from Visual Studio and
set Seasar.Examples project as a startup project. When the example is executed, ExamplesExplorer should start.
</p>
<p>
Some of the examples require SQL Server 2000 (or MSDE 2000). Before running these examples, execute s2container.net/data/setUpDemo.bat to create the necessary tables and set database connection string in Tx.dicon and DTCTx.dicon files in Seasar.Examples folder.
</p>


<!-- document end -->
<!-- don't edit start -->
</td>
          <td width=14><img height=14 alt="" src="images/spacer.gif" 
            width=14></td></tr>
        <tr>
          <td width=14><img height=30 alt="" src="images/spacer.gif" 
            width=14></td>
          <td width=766><img height=30 alt="" src="images/spacer.gif" 
            width=592></td></tr>
        <tr>
          <td width=14><img height=14 alt="" src="images/spacer.gif" 
            width=14></td>
<td class=copyright><table cellSpacing=0 cellPadding=0 width=736><tr><td align="left">Trans. by H.Ozawa</td><td align="right">Copyright&copy; 2004-2010, The Seasar Foundation and the others. All rights reserved.</td></tr></table></td>
</tr></table>
    <td class=backright vAlign=top align=left>&nbsp;</td></tr>
  <tr>
    <td class=backunder vAlign=top align=left width=780 height=16>&nbsp;</td>
    <td class=backcorner vAlign=top align=left 
height=16>&nbsp;</td></tr></tbody></table>
<!-- don't edit end -->
</body></html>
