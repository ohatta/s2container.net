<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Quillで簡単DI+AOP - S2Container.NET</title>
	<link href="css/common.css" rel="stylesheet" type="text/css" media="screen,print" />
	<link href="css/csharp.css" rel="stylesheet" type="text/css" media="screen,print" />
</head>

<body>
<a name="top"/>
<div class="container">

<div>
	<div class="logo"><img src="images/title_s2containernet.png" alt="S2Container.NET プロジェクト" /></div>
	<hr />
	<div class="pan">
		<a href="http://www.seasar.org/">Seasarプロジェクト</a>
		＞ <a href="seasarnet.html">Seasar.NETプロジェクト</a>
		＞ <a href="index.html">S2Container.NET</a>
		＞ Quillで簡単DI+AOP
	</div>
</div>

<div class="middle">

<div class="menus">

	<div class="menuLine">
	<div class="menu">
	
		<div class="menuTitle">
			<img src="images/s2containernet.png" alt="S2Container.NET" />
		</div>
		
		<div class="menuBody">
			<ul>
				<li><a href="index.html">Welcome</a></li>
				<li><a href="download.html">ダウンロード</a></li>
			</ul>
		</div>
	</div>
	</div>
	
	<div class="menuLine">
	<div class="menu">
	
		<div class="menuTitle">
			<img src="images/documentation.png" alt="ドキュメンテーション" />
		</div>
		
		<div class="menuBody">
			<ul>
				<li><a href="setup.html">セットアップ</a></li>
				<li><a href="dicontainer.html">DIContainer</a></li>
				<li><a href="aop.html">AOP</a></li>
				<li><a href="asp.html">ASP.NETでの利用</a></li>
				<li><a href="db.html">データベース接続</a></li>
				<li><a href="tx.html">トランザクション</a></li>
				<li><a href="s2ado.html">S2ADO</a></li>
				<li><a href="s2unit.html">S2Unit.NET</a></li>
				<li><a href="s2windows.html">S2Windows.NET</a></li>
				<li><a href="jscript.html">JScript.NET式</a></li>
				<li>Quillで簡単DI+AOP</li>
			</ul>
		</div>
	</div>
	</div>

	<div class="menuLine">	
	<div class="menu">
	
		<div class="menuTitle">
			<img src="images/support.png" alt="サポート" />
		</div>
		
		<div class="menuBody">
			<ul>
				<li>
					<a href="faq.html">FAQ</a>
					<p>よくある質問と答えをまとめています。</p>
				</li>
				<li>
					<a href="https://ml.seasar.org/mailman/listinfo/seasar-dotnet">Mailing List</a>
					<p>Seasar.NETに関する議論を行うメーリングリストです。</p>
				</li>
				<li>
					<a href="https://www.seasar.org/issues/browse/CONTAINERNET">トラッキング</a>
					<p>S2Container.NETのバグや問題の検索、報告を行うことができます。</p>
				</li>
			</ul>
		</div>
	</div>
	</div>

</div><!-- div.left -->

<!-- ############################################# コンテンツ ######################################################### -->

<div class="contents">
	
	<div class="content">
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>目次</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　Quillを使うことにより簡単にDIやAOPを行うことができます。
			Quillでは属性を用いてDIやAOPの設定を行います。
			S2Container.NET 1.3.0から追加された機能です。</p>
			<p>　ステートレスな業務ロジックを構築するために作成された為、S2Container.NETに比べると機能が制限されています。
			ただしS2Container.NETと連携してS2Container.NETに登録されているコンポーネントを利用する機能があります。</p>

			<ul>
				<li><a href="#setup">セットアップ</a></li>
				<li>
					<a href="#di">DIを利用する</a>
					<ul>
						<li><a href="#di_quill">Quillでインスタンスを管理するオブジェクトをDIする</a></li>
						<li><a href="#di_s2">S2Containerでインスタンスを管理するオブジェクトをDIする</a></li>
						<li><a href="#di_notice">注意点</a></li>
					</ul>
				</li>
				<li>
					<a href="#aop">AOPを利用する</a>
					<ul>
						<li><a href="#aop_quill">Quillでインスタンスを管理するInterceptorを使用する</a></li>
						<li><a href="#aop_s2">S2Containerでインスタンスを管理するInterceptorを使用する</a></li>
						<li><a href="#aop_notice">注意点</a></li>
					</ul>
				</li>
				<li><a href="#form">Windowsアプリケーションから簡単にQuillを利用する
			</ul>
			
		</div>
	</div>
	

<!-- ############################################# セットアップ ######################################################### -->
	<div class="content">
		<a name="setup" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>セットアップ</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　Quillのセットアップについては、以下のドキュメントを参照してください。</p>
			<p>　<a href="setup.html#quill">セットアップ - Quillのセットアップ</a></p>
			
		</div>
	</div>
	
<!-- ############################################# DIを利用する ######################################################### -->
	<div class="content">
		<a name="di" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>DIを利用する</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">

			<h2><a name="di_quill">Quillでインスタンスを管理するオブジェクトをDIする</a></h2>

			<p>　DIを行う為にはSeasar.Quill.QuillInjectorクラスのInjectメソッドに、DIを行わせたいオブジェクトを渡します。</p>
			<p>　QuillInjectorはInjectメソッドに渡されたオブジェクトのフィールドから自動的に判断して、
			必要なオブジェクトをフィールドにバインドします。その際にあらかじめ設定ファイルでコンポーネントを登録しておく必要はありません。
			フィールドの型にSeasar.Quill.Attrs.ImplementationAttributeクラスが属性として設定されている場合に、
			バインドすべきと判断して自動的にバインドを行います。</p>
			<p>　初めてバインドされるオブジェクトは新しくインスタンス化されますが、
			一度バインドされたオブジェクトは以後同じインスタンスがバインドされることになります。
			つまりQuillでバインドするためにインスタンス化されるオブジェクトは全てsingletonになります。
			これはQuillがステートレスな業務ロジックを構築することを目的に作られたからです。</p>
			<p>　下記の例ではIEmployeeLogicインターフェースの実装クラスであるEmployeeLogicクラスを
			Form1のフィールドにバインドします。もしEmployeeLogicクラスがフィールドを持ち、
			そのフィールドの型にImplementationAttributeクラスが属性として設定されていれば連鎖的にバインディングが行われていきます。</p>
			
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">static</span> <span class="kwrd">class</span> Program
{
    [STAThread]
    <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
    {
        Form1 form = <span class="kwrd">new</span> Form1();

        QuillInjector injector = QuillInjector.GetInstance();
        injector.Inject(form);
        ・・(略)・・
    }
}


<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Form1 : Form
{
    <span class="rem">// IEmployeeLogicの実装クラスであるEmployeeLogicのインスタンスがバインドされる</span>
    <span class="kwrd">protected</span> IEmployeeLogic employeeLogic;
    
    <span class="kwrd">public</span> Form1()
    {
            InitializeComponent();
    }
    ・・(略)・・
}


[Implementation(<span class="kwrd">typeof</span>(EmpployeeLogic))]
<span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeLogic
{
    ・・(略)・・
}


<span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeLogic : IEmployeeLogic
{
    ・・(略)・・
}</pre>

			<p>　上記のようなインターフェースを用意せずに直接クラスのインスタンスをバインディングする場合は、
			下記のようにImplementationAttributeクラスに引数を指定しません。</p>

<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Form1 : Form
{
    <span class="rem">// EmployeeLogicのインスタンスがバインドされる</span>
    <span class="kwrd">protected</span> EmployeeLogic employeeLogic;
    
    <span class="kwrd">public</span> Form1()
    {
            InitializeComponent();
    }
    ・・(略)・・
}


[Implementation]
<span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeLogic
{
    ・・(略)・・
}</pre>

			<p>　また下記のように引数無しのImplementationAttributeクラスをインターフェースに指定して、
			Aspectで実装を持たせることもできます。</p>

<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Form1 : Form
{
    <span class="rem">// Aspectによって拡張された型のインスタンスがバインドされる</span>
    <span class="kwrd">protected</span> IEmployeeLogic employeeLogic;
    
    <span class="kwrd">public</span> Form1()
    {
            InitializeComponent();
    }
    ・・(略)・・
}


[Implementation]
[Aspect(<span class="kwrd">typeof</span>(HogeInterceptor))]
<span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeLogic
{
    ・・(略)・・
}</pre>

			<h2><a name="di_s2">S2Containerでインスタンスを管理するオブジェクトをDIする</a></h2>
			
			<p>　フィールドにSeasar.Quill.Attrs.BindingAttributeクラスが属性として指定されている場合は、
			S2Containerでインスタンスを管理するオブジェクトをバインディングします。
			BindingAttributeクラスの引数にはS2Containerのコンポーネント名を指定します。</p>
			<p>　下記の例ではS2Containerにコンポーネント名"empLogic"として定義されているコンポーネントのインスタンスを
			 Form1のフィールドにバインドします。</p>
			
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">static</span> <span class="kwrd">class</span> Program
{
    [STAThread]
    <span class="kwrd">static</span> <span class="kwrd">void</span> Main()
    {

        <span class="rem">// 定義(dicon)ファイルをセットする</span>
        SingletonS2ContainerFactory.ConfigPath = <span class="str">"App.dicon"</span>;

        <span class="rem">// S2Containerを初期化する</span>
        SingletonS2ContainerFactory.Init();

        Form1 form = <span class="kwrd">new</span> Form1();

        QuillInjector injector = QuillInjector.GetInstance();
        injector.Inject(form);
        ・・(略)・・
    }
}


<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Form1 : Form
{
    [Binding(<span class="str">"empLogic"</span>)]
    <span class="kwrd">protected</span> IEmployeeLogic employeeLogic;
    
    <span class="kwrd">public</span> Form1()
    {
            InitializeComponent();
    }
    ・・(略)・・
}


<span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeLogic
{
    ・・(略)・・
}


<span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeLogic : IEmployeeLogic
{
    ・・(略)・・
}</pre>

			<p class="kindCode">App.dicon</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="empLogic"</span>
        <span class="attr">class</span><span class="kwrd">="HogeNamespace.EmployeeLogic"</span> <span class="kwrd">/&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span></pre>
			

			<h2><a name="di_notice">注意点</a></h2>
			<ul>
				<li>バインディングさせるために用意するフィールドのアクセス修飾子はprotectedかpublicにします
				（Aspectを利用しない場合はprivateでも可）</li>
				<li>Quillでインスタンスを管理するオブジェクトのインスタンスはsingletonになります</li>
				<li>Quillでインスタンスを管理するオブジェクトはインターフェース1つに実装クラス2つという場合に、
				動的に実装クラスを切り替えるといったことはできません
				（ImplementationAttributeの引数を変更して静的に変更することは可能です）
				そのような場合はS2Containerで実装クラスを切り替える仕組みを作成する必要があります</li>
				<li>QuillからS2Containerを利用する場合、
				SingletonS2ContainerFactoryから取得できるS2Containerのみを利用することができます</li>
			</ul>

		</div>
	</div>
	
	
<!-- div.contents -->
</div>
<br class="clear" />
<!-- div.middle -->
</div>

<div class="bottom">
	<hr />
	<div class="copyright">
		&#169; Copyright The Seasar Project and the others 2004-2007, all rights reserved.
	</div>
</div>

</body>

</html>