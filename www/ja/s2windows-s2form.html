<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>S2Windows.NET S2Form - S2Container.NET</title>
	<link href="css/common.css" rel="stylesheet" type="text/css" media="screen,print" />
	<link href="css/csharp.css" rel="stylesheet" type="text/css" media="screen,print" />
</head>

<body>
<a name="top"/>
<div class="container">

<div>
	<div class="logo"><img src="images/title_s2containernet.png" alt="S2Container.NET プロジェクト" /></div>
	<hr />
	<div class="pan">
		<a href="http://www.seasar.org/">Seasarプロジェクト</a>
		＞ <a href="seasarnet.html">Seasar.NETプロジェクト</a>
		＞ <a href="index.html">S2Container.NET</a>
		＞ <a href="s2windows.html">S2Windows.NET</a>
		＞ S2Form
	</div>
</div>

<div class="middle">

<div class="menus">

	<div class="menuLine">
	<div class="menu">
	
		<div class="menuTitle">
			<img src="images/s2containernet.png" alt="S2Container.NET" />
		</div>
		
		<div class="menuBody">
			<ul>
				<li><a href="index.html">Welcome</a></li>
				<li><a href="download.html">ダウンロード</a></li>
			</ul>
		</div>
	</div>
	</div>
	
	<div class="menuLine">
	<div class="menu">
	
		<div class="menuTitle">
			<img src="images/documentation.png" alt="ドキュメンテーション" />
		</div>
		
		<div class="menuBody">
			<ul>
				<li><a href="setup.html">セットアップ</a></li>
				<li><a href="update-operation.html">移行</a></li>
				<li><a href="dicontainer.html">DIContainer</a></li>
				<li><a href="aop.html">AOP</a></li>
				<li><a href="asp.html">ASP.NETでの利用</a></li>
				<li><a href="db.html">データベース接続</a></li>
				<li><a href="tx.html">トランザクション</a></li>
				<li><a href="s2ado.html">S2ADO</a></li>
				<li><a href="s2unit.html">S2Unit.NET</a></li>
				<li>
					<a href="s2windows.html">S2Windows.NET</a>
					<ul>
						<li><a href="s2windows-control.html">画面遷移をコントロール</a></li>
						<li>S2Form</li>
					</ul>
				</li>
				<li><a href="jscript.html">JScript.NET式</a></li>
				<li><a href="quill.html">Quillで簡単DI+AOP</a></li>
				<li><a href="s2dxo.html">S2DXO</a></li>
			</ul>
		</div>
	</div>
	</div>

	<div class="menuLine">	
	<div class="menu">
	
		<div class="menuTitle">
			<img src="images/support.png" alt="サポート" />
		</div>
		
		<div class="menuBody">
			<ul>
				<li>
					<a href="faq.html">FAQ</a>
					<p>よくある質問と答えをまとめています。</p>
				</li>
				<li>
					<a href="https://ml.seasar.org/mailman/listinfo/seasar-dotnet">Mailing List</a>
					<p>Seasar.NETに関する議論を行うメーリングリストです。</p>
				</li>
				<li>
					<a href="https://www.seasar.org/issues/browse/CONTAINERNET">トラッキング</a>
					<p>S2Container.NETのバグや問題の検索、報告を行うことができます。</p>
				</li>
			</ul>
		</div>
	</div>
	</div>

</div><!-- div.left -->

<!-- ############################################# コンテンツ ######################################################### -->

<div class="contents">
	
	<div class="content">
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>目次</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　S2FormはS2Container.NET 1.3.0 からの機能です。
			<span class="important">.NET Framework 2.0以上にのみ対応しています。</a></p>

			<ul>
				<li><a href="#form">S2Formとは</a></li>
				<li><a href="#start">S2FormによるWindowsFormの作り方</a></li>
				<li><a href="#control">コントロールの作成</a></li>
				<li><a href="#pono">バインドするPONOの作り方</a></li>
				<li><a href="#bind">PONOのバインドの仕方と取得の仕方</a></li>
				<li><a href="#reflect">バインドしたPONOの値を変更してコントロールに反映する</a></li>
				<li><a href="#grid">Gridタイプコントロール</a></li>
			</ul>
			
		</div>
	</div>
	
<!-- ############################################# S2Formとは ######################################################### -->

	<div class="content">
		<a name="form" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>S2Formとは</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　PONO(Plain Old .NET Object)オブジェクトを自動的にバインドするWindowsFormです。 </p>
			<p>　PONOをS2FormのDataSourceプロパティにセットすると、PONOがコントロールに自動的にバインドされます。
			コントロールに入力すると、バインドされたPONOの値が更新されます。ですので、DataSourceプロパティを使って、
			PONOを更新した値で取得することができます。 </p>
			
		</div>
	</div>

<!-- ############################################# S2FormによるWindowsFormの作り方 ######################################################### -->

	<div class="content">
		<a name="start" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>S2FormによるWindowsFormの作り方</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　S2Formを実際に使用するには、Seasar.Windows.S2Formを継承したWindowsFormを作ります。
			Visual Studio2005上では次のように作成します。 </p>
			<p>　新しい項目の追加から継承されたフォームを選択します。 </p>
			<img src="images/s2form1.jpg" />
			<p>　次に、継承元とのDLLを選択します。次の画面で参照ボタンを押します。</p>
			<img src="images/s2form2.jpg" />
			<p>　Seasar.Windows.Dllを選択します。 </p>
			<img src="images/s2form3.jpg" />
			<p>　すると次のように表示されるので、 </p>
			<img src="images/s2form4.jpg" />
			<p>　S2Formを選択して、OKボタンを押します。 </p>
			
		</div>
	</div>
	
<!-- ############################################# コントロールの作成 ######################################################### -->

	<div class="content">
		<a name="control" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>コントロールの作成</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　普通の開発のように、作成したWindowsFormの上にコントロールを作成します。
			このコントロールの名前はPONOで つけやすい名前にしておくほうが良いでしょう。 </p>
			<p>　コントロールの命名にハンガリアン記法を使っているとき、
			あるいはコントロール名に修飾子をつけているがPONOのプロパティ名につけたくないときにはControlModifier属性を使用します。 </p>
			<p>　ControlModifier属性は次のような仕様になっています。WindowsFormのクラス属性で、
			一つ目の引数がコントロール名の前につける修飾子で、二つ目の引数がコントロール名の後につける修飾子です。</p>
			<p class="kindCode">C#</p>
<pre class="csharpcode">
[<span class="kwrd">ControlModifier</span>("txt", "")]
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> FrmEmployeeList : S2Form
{
&nbsp;...
}
</pre>

			<p class="kindCode">VB</p>
<pre class="csharpcode vb">
&lt;<span class="kwrd">ControlModifier</span>("txt", "")&gt; _
<span class="kwrd">Public</span> <span class="kwrd">Class</span> FrmEmployeeList
&nbsp;...
<span class="kwrd">End</span> <span class="kwrd">Class</span>
</pre>

			<p>　バインドするときに使用するコントロールのプロパティはTextです。これを持たないコントロールの場合はControl属性を 使用します。
			また、修飾子の都合でプロパティと関係付けられないときに使用します。 </p>
			
			<table border="0" cellspacing="1">
				<tr>
					<th width="190px">名前</th>
					<th>説明</th>
				<tr>
					<td width="190px">Control(controlName, controlProperty, propertyName)</td>
					<td>
						<ul>
							<li>controlNameは対象となるコントロール名</li>
							<li>controlPropertyは対象コントロールのプロパティ</li>
							<li>propertyNameはPONOのプロパティ名</li>
						</ul>
					</td>
				</tr>
				<tr>
					<td width="190px">Control(controlName, controlProperty, propertyName, updateMode)</td>
					<td>
						<ul>
							<li>controlNameは対象となるコントロール名</li>
							<li>controlPropertyは対象コントロールのプロパティ</li>
							<li>propertyNameはPONOのプロパティ名</li>
							<li>updateModeはデータソースの更新タイミング</li>
						</ul>
					</td>
				</tr>
				<tr>
					<td width="190px">Control(controlName, controlProperty, propertyName, formattingEnabled, updateMode, nullValue, formatString)</td>
					<td>
						<ul>
							<li>controlNameは対象となるコントロール名</li>
							<li>controlPropertyは対象コントロールのプロパティ</li>
							<li>propertyNameはPONOのプロパティ名</li>
							<li>formattingEnabledは表示されるデータの書式を指定する場合は true</li>
							<li>updateModeはデータソースの更新タイミング</li>
							<li>nullValueはデータ ソースの値がDBNullである場合に、バインドされたコントロールプロパティに適用されるObject</li>
							<li>formatStringは値の表示方法を示す1つ以上の書式指定子文字</li>
						</ul>
					</td>
				</tr>
			</table>
			
			<p>　バインドするプロパティの優先順位は、Control属性が先で、次にPONOのプロパティです。 </p>
			<p class="kindCode">C#</p>
<pre class="csharpcode">
[<span class="kwrd">ControlModifier</span>("txt", "")]
[<span class="kwrd">Control</span>("lblName", "Text", "Name")]
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> FrmEmployeeList : S2Form
{
&nbsp;...
}
</pre>

			<p clas="kindCode">VB</p>
<pre class="csharpcode vb">
&lt;<span class="kwrd">ControlModifier</span>("txt", "")&gt; _
&lt;<span class="kwrd">Control</span>("lblName", "Text", "Name")&gt; _
<span class="kwrd">Public</span> <span class="kwrd">Class</span> FrmEmployeeList
&nbsp;...
<span class="kwrd">End</span> <span class="kwrd">Class</span>
</pre>
			
			<p>　コントロールの値の変更がPONOに反映されるタイミングはDataSourceUpdateMode#OnValidationがデフォルトです。
			 コントロールの値を即座に反映するように変更するときにはControl属性を次のように使用します。 </p>
			 <p class="kindCode">C#</p>
<pre class="csharpcode">
[<span class="kwrd">ControlModifier</span>("txt", "")]
[<span class="kwrd">Control</span>("lblName", "Text", "Name", DataSourceUpdateMode.OnPropertyChanged)]
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> FrmEmployeeList : S2Form
{
&nbsp;...
}
</pre>

			<p class="kindCode">VB</p>
<pre class="csharpcode vb">
&lt;<span class="kwrd">ControlModifier</span>("txt", "")&gt; _
&lt;<span class="kwrd">Control</span>("lblName", "Text", "Name", DataSourceUpdateMode.OnPropertyChanged)&gt; _
<span class="kwrd">Public</span> <span class="kwrd">Class</span> FrmEmployeeList
&nbsp;...
<span class="kwrd">End</span> <span class="kwrd">Class</span>
</pre>
			
		</div>
	</div>
	
<!-- ############################################# バインドするPONOの作り方 ######################################################### -->

	<div class="content">
		<a name="pono" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>バインドするPONOの作り方</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　そのPONOのプロパティをコントロールと同じ名前にします。
			または、独自の名前をつけて、Control属性でコントロールと PONOのプロパティを紐付けるようにします。 </p>
			
		</div>
	</div>
	
<!-- ############################################# PONOのバインドの仕方と取得の仕方 ######################################################### -->

	<div class="content">
		<a name="bind" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>PONOのバインドの仕方と取得の仕方</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　S2FormのDataSourceプロパティを使用します。 </p>
			<h2>PONOをセットする</h2>
			<p class="kindCode">C#</p>
<pre class="csharpcode">
EmployeeListDto data = _service.GetAll();
this.DataSource = data;
</pre>

			<p class="kindCode">VB</p>
<pre class="csharpcode vb">
Dim data As EmployeeListDto = _service.GetAll();
Me.DataSource = data;
</pre>

			<h2>PONOを取得する</h2>
			<p class="kindCode">C#</p>
<pre class="csharpcode">
EmployeeListDto data = (EmployeeListDto)this.DataSource;
</pre>

			<p class="kindCode">VB</p>
<pre class="csharpcode vb">
Dim data As EmployeeListDto = CType(Me.DataSource, EmployeeListDto)
</pre>
			
		</div>
	</div>
	
<!-- ############################################# バインドしたPONOの値を変更してコントロールに反映する ######################################################### -->

	<div class="content">
		<a name="reflect" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>バインドしたPONOの値を変更してコントロールに反映する</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　二つの方法があり、一つ目の方法はもう一度PONOをバインドすることです。
			二つ目の方法はバインドしたPONOを変更した後、 S2FormのReadValuesメソッドを実行します。 </p>
<pre class="csharpcode">
((EmployeeListDto) this.DataSource).Code = "0001";
this.ReadValues();
</pre>

			<p>　逆に、コントロールの値をバインドしているPONOに強制的に書き出すメソッドとしてWriteValuesメソッドを用意しています。 
			通常は必要としないと思います。 </p>
			
		</div>
	</div>
	
<!-- ############################################# Gridタイプコントロール ######################################################### -->

	<div class="content">
		<a name="grid" />
		<div class="contentHeader">
			<div class="contentHeader1">
				<h1>Gridタイプコントロール</h1>
			</div>
			<div class="contentHeader2">
				<a href="#top"><img src="images/up.png" />上へ</a>
			</div>
			<br class="clear" />
		</div>
		<div class="contentBody">
		
			<p>　現在、DataGridViewとSPREAD2.5Jで動作確認しています。</p>
			<p>　Gridタイプのコントロールにバインドする場合、バインドさせるPONOにIList、ジェネリックIList、配列、
			DataTable、IEnumerable、ジェネリックIEnumerableのプロパティを持たせます。 そのプロパティをControl属性で設定します。
			設定先は一般的にはGridコントロールのDataSourceプロパティになります。 </p>
			<p>　Gridタイプコントロールのプロパティに格納するコレクションに含めるPONOは別に設定します。
			<span class="important">こちらの 自動バインディングには対応していません。</span>
			 一部のコンポーネントはバインドすると列サイズが変わることがあり、それを元のサイズに設定し直す処理を 含める必要があります。 
			同様に、列の自動生成がデフォルトで行われる場合があり、停止する必要があります。 </p>
			
<pre class="csharpcode">
[<span class="kwrd">ControlModifier</span>("txt", "")]
[<span class="kwrd">Control</span>("lblName", "Text", "Name")]
[<span class="kwrd">Control</span>("sprList", "DataSource", "List")]
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> FrmEmployeeList : S2Form
{
&nbsp;...
}
</pre>

			<p>　上記の例では、二つ目のControl属性([Control("sprList", "DataSource", "List")])でセットしています。 </p>
			
			<h2>行を挿入する</h2>
			<p>　バインドしていると、Gridコントロールのメソッドを使って行を挿入することができません。
			そこでS2FormのAddRowメソッドを使って、挿入します。 </p>
			
			<table border="0" cellspacing="1">
				<tr>
					<th>名前</th>
					<th>説明</th>
				<tr>
					<td>AddRow(propertyName, data, row)</td>
					<td>
						<ul>
							<li>propertyNameは対象となるPONOのプロパティ名</li>
							<li>dataは挿入するデータ</li>
							<li>rowは挿入位置の行番号</li>
							<li>戻り値は挿入行数</li>
						</ul>
					</td>
				</tr>
			</table>
			
			<h2>行を削除する</h2>
			<p>　行の挿入と同様に、バインドしているとGridコントロールのメソッドを使って行を削除することが できません。
			そこでS2FormのDeleteRowメソッドを使って、削除します。
			複数の行を削除するときはDeleteRowsメソッドを使用します。 </p>
			
			<table border="0" cellspacing="1">
				<tr>
					<th>名前</th>
					<th>説明</th>
				<tr>
					<td>DeleteRow(propertyName, row)</td>
					<td>
						<ul>
							<li>propertyNameは対象となるPONOのプロパティ名</li>
							<li>rowは削除位置の行番号</li>
							<li>戻り値は削除行数</li>
						</ul>
					</td>
				</tr>
				<tr>
					<td>DeleteRows(propertyName, startRow, endRow)</td>
					<td>
						<ul>
							<li>propertyNameは対象となるPONOのプロパティ名</li>
							<li>startRowは削除開始行番号</li>
							<li>endRowは削除終了行番号</li>
							<li>戻り値は削除行数</li>
						</ul>
					</td>
				</tr>
			</table>
			
			<h2>行を移動させる</h2>
			<p>　一つ行を移動させる処理を行うには、行の追加や削除と同様にGridコントロールのメソッドを使って行うことはバインドしている限りできません。
			そこで行を一つあげるときはMoveUpRowメソッドを使います。行を一つ下げる ときにはMoveDownRowメソッドを使います。  </p>
			
			<table border="0" cellspacing="1">
				<tr>
					<th>名前</th>
					<th>説明</th>
				<tr>
					<td>MoveUpRow(propertyName, row)</td>
					<td>
						<ul>
							<li>propertyNameは対象となるPONOのプロパティ名</li>
							<li>rowは移動させる行の行番号</li>
						</ul>
					</td>
				</tr>
				<tr>
					<td>MoveDownRow(propertyName, row)</td>
					<td>
						<ul>
							<li>propertyNameは対象となるPONOのプロパティ名</li>
							<li>rowは移動させる行の行番号</li>
						</ul>
					</td>
				</tr>
			</table>
			
		</div>
	</div>
	
<!-- div.contents -->
</div>
<br class="clear" />
<!-- div.middle -->
</div>

<div class="bottom">
	<hr />
	<div class="copyright">
		&#169; Copyright The Seasar Project and the others 2004-2009, all rights reserved.
	</div>
</div>

</body>

</html>